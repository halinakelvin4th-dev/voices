<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Creator Studio - Complete SaaS</title>
    
    <!-- 1. Tailwind CSS (Design) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Lucide Icons (Icons) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- 3. Supabase SDK (Database) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* Custom Scrollbar Styling */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Range Slider Styling */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px; width: 16px;
            border-radius: 50%;
            background: #10b981;
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            background: #334155;
            border-radius: 2px;
        }

        /* Audio Player Styling */
        audio {
            width: 100%;
            height: 40px;
            filter: invert(1) hue-rotate(180deg);
            opacity: 0.9;
            border-radius: 8px;
        }

        /* Glassmorphism & Animations */
        .glass-panel {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        @keyframes bounce-in {
            0% { transform: scale(0.9); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }
        .notification-pop { animation: bounce-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body class="bg-[#0B1120] text-white font-sans h-screen flex flex-col overflow-hidden">

    <!-- ================= 1. AUTHENTICATION SCREEN ================= -->
    <div id="auth-view" class="absolute inset-0 z-50 flex items-center justify-center bg-[#0B1120]">
        <!-- Decorative Background -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
            <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-indigo-600/20 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-emerald-600/20 rounded-full blur-[100px]"></div>
        </div>

        <div class="glass-panel p-10 rounded-3xl w-full max-w-md shadow-2xl relative z-10">
            
            <!-- Login Form -->
            <div id="login-form-container">
                <div class="text-center mb-8">
                    <div class="inline-flex p-4 rounded-2xl bg-indigo-500/10 text-indigo-400 mb-4">
                        <i data-lucide="lock" class="w-8 h-8"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-white tracking-tight">Welcome Back</h1>
                    <p class="text-slate-400 text-sm mt-2">Login to access your studio</p>
                </div>
                <form onsubmit="handleLogin(event)" class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1 uppercase">Username</label>
                        <input type="text" id="login-user" class="w-full bg-[#0f172a] border border-slate-700 rounded-xl px-5 py-3 text-white outline-none focus:border-indigo-500 transition-colors" placeholder="Enter your username">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1 uppercase">Password</label>
                        <input type="password" id="login-pass" class="w-full bg-[#0f172a] border border-slate-700 rounded-xl px-5 py-3 text-white outline-none focus:border-indigo-500 transition-colors" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button type="submit" class="w-full py-3.5 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl shadow-lg shadow-indigo-900/50 transform active:scale-95 transition-all">
                        Login to Dashboard
                    </button>
                </form>
                <p class="text-center text-sm text-slate-500 mt-6">
                    Don't have an account? <button onclick="toggleAuthMode('signup')" class="text-indigo-400 hover:text-indigo-300 font-bold transition-colors">Create one</button>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signup-form-container" class="hidden">
                <div class="text-center mb-8">
                    <div class="inline-flex p-4 rounded-2xl bg-emerald-500/10 text-emerald-400 mb-4">
                        <i data-lucide="user-plus" class="w-8 h-8"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-white tracking-tight">Join Studio</h1>
                    <p class="text-slate-400 text-sm mt-2">Start creating audio for free</p>
                </div>
                <form onsubmit="handleSignup(event)" class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1 uppercase">Email Address</label>
                        <input type="email" id="signup-email" required class="w-full bg-[#0f172a] border border-slate-700 rounded-xl px-5 py-3 text-white outline-none focus:border-emerald-500 transition-colors" placeholder="name@example.com">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1 uppercase">Username</label>
                        <input type="text" id="signup-user" required class="w-full bg-[#0f172a] border border-slate-700 rounded-xl px-5 py-3 text-white outline-none focus:border-emerald-500 transition-colors" placeholder="username_no_spaces">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1 uppercase">Password</label>
                        <input type="password" id="signup-pass" required class="w-full bg-[#0f172a] border border-slate-700 rounded-xl px-5 py-3 text-white outline-none focus:border-emerald-500 transition-colors" placeholder="Create a strong password">
                    </div>
                    <button type="submit" class="w-full py-3.5 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl shadow-lg shadow-emerald-900/50 transform active:scale-95 transition-all">
                        Create Account
                    </button>
                </form>
                <p class="text-center text-sm text-slate-500 mt-6">
                    Already have an account? <button onclick="toggleAuthMode('login')" class="text-emerald-400 hover:text-emerald-300 font-bold transition-colors">Login</button>
                </p>
            </div>
            
            <!-- Error Message Area -->
            <p id="auth-error" class="text-red-400 text-xs text-center mt-4 hidden bg-red-500/10 p-3 rounded-lg border border-red-500/20 font-medium"></p>
        </div>
    </div>

    <!-- ================= 2. ADMIN PANEL VIEW ================= -->
    <div id="admin-view" class="absolute inset-0 z-40 bg-[#0B1120] hidden flex flex-col">
        <!-- Navbar -->
        <div class="border-b border-slate-800 bg-[#0f172a] px-8 py-4 flex justify-between items-center shadow-md z-20">
            <h2 class="text-xl font-bold text-white flex items-center gap-3">
                <span class="bg-emerald-500/10 p-2 rounded-lg"><i data-lucide="shield" class="w-5 h-5 text-emerald-500"></i></span>
                Admin Dashboard
            </h2>
            <div class="flex gap-4">
                <button onclick="goToToolAsAdmin()" class="px-5 py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold rounded-xl flex items-center gap-2 transition-all shadow-lg">
                    <i data-lucide="mic" class="w-4 h-4"></i> Open Generator
                </button>
                <button onclick="logout()" class="px-5 py-2.5 bg-slate-800 hover:bg-slate-700 text-red-400 text-sm font-bold rounded-xl border border-slate-700 transition-all flex items-center gap-2">
                    <i data-lucide="log-out" class="w-4 h-4"></i> Logout
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-8 max-w-7xl mx-auto w-full space-y-8">
            
            <!-- Stats Row -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-panel p-6 rounded-2xl border-l-4 border-indigo-500 relative overflow-hidden group">
                    <div class="relative z-10">
                        <p class="text-slate-400 text-xs uppercase font-bold tracking-wider">Total Users</p>
                        <h3 class="text-4xl font-extrabold text-white mt-2" id="admin-total-users">...</h3>
                    </div>
                    <i data-lucide="users" class="absolute right-4 bottom-4 w-16 h-16 text-indigo-500/10 group-hover:text-indigo-500/20 transition-colors"></i>
                </div>
                <div class="glass-panel p-6 rounded-2xl border-l-4 border-emerald-500 relative overflow-hidden group">
                    <div class="relative z-10">
                        <p class="text-slate-400 text-xs uppercase font-bold tracking-wider">Total Revenue</p>
                        <h3 class="text-4xl font-extrabold text-white mt-2">$<span id="admin-revenue">...</span></h3>
                    </div>
                    <i data-lucide="dollar-sign" class="absolute right-4 bottom-4 w-16 h-16 text-emerald-500/10 group-hover:text-emerald-500/20 transition-colors"></i>
                </div>
                <div class="glass-panel p-6 rounded-2xl border-l-4 border-amber-500 relative overflow-hidden group">
                    <div class="relative z-10">
                        <p class="text-slate-400 text-xs uppercase font-bold tracking-wider">Pending Requests</p>
                        <h3 class="text-4xl font-extrabold text-white mt-2" id="admin-pending-count">...</h3>
                        <span class="absolute top-6 right-6 h-3 w-3 bg-red-500 rounded-full animate-pulse shadow-[0_0_15px_rgba(239,68,68,0.6)] hidden" id="admin-notification-dot"></span>
                    </div>
                    <i data-lucide="clock" class="absolute right-4 bottom-4 w-16 h-16 text-amber-500/10 group-hover:text-amber-500/20 transition-colors"></i>
                </div>
            </div>

            <!-- Main Columns -->
            <div class="grid lg:grid-cols-2 gap-8 h-[600px]">
                
                <!-- Payment Requests -->
                <div class="glass-panel rounded-3xl flex flex-col overflow-hidden shadow-2xl">
                    <div class="p-6 border-b border-slate-700 bg-slate-800/50 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-white flex items-center gap-2">
                            <i data-lucide="credit-card" class="w-5 h-5 text-amber-400"></i> Upgrade Requests
                        </h3>
                        <button onclick="loadAdminData()" class="p-2 hover:bg-slate-700 rounded-full text-slate-400 hover:text-white transition-colors"><i data-lucide="refresh-cw" class="w-4 h-4"></i></button>
                    </div>
                    <div id="requests-list" class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
                        <!-- Requests will be loaded here -->
                        <div class="flex flex-col items-center justify-center h-full text-slate-500 space-y-2">
                            <i data-lucide="inbox" class="w-12 h-12 opacity-20"></i>
                            <p class="text-sm font-medium">No pending requests found.</p>
                        </div>
                    </div>
                </div>

                <!-- User Database -->
                <div class="glass-panel rounded-3xl flex flex-col overflow-hidden shadow-2xl">
                    <div class="p-6 border-b border-slate-700 bg-slate-800/50 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-white flex items-center gap-2">
                            <i data-lucide="database" class="w-5 h-5 text-blue-400"></i> User Database
                        </h3>
                        <div class="text-xs text-slate-400 font-mono bg-slate-800 px-2 py-1 rounded border border-slate-700">Live Sync</div>
                    </div>
                    <div class="flex-1 overflow-y-auto custom-scrollbar">
                        <table class="w-full text-left text-sm text-slate-400">
                            <thead class="bg-slate-800/80 text-slate-200 sticky top-0 backdrop-blur-sm">
                                <tr>
                                    <th class="p-4 font-bold">User Details</th>
                                    <th class="p-4 font-bold">Current Plan</th>
                                    <th class="p-4 font-bold text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="user-table-body" class="divide-y divide-slate-800">
                                <!-- Users loaded via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Notification Toast -->
        <div id="admin-toast" class="fixed top-24 right-8 max-w-sm bg-slate-800 border-l-4 border-emerald-500 shadow-2xl rounded-xl p-4 hidden z-50 notification-pop flex items-start gap-4">
            <div class="bg-emerald-500/10 p-2 rounded-full">
                <i data-lucide="bell-ring" class="w-6 h-6 text-emerald-500"></i>
            </div>
            <div class="flex-1">
                <h3 class="font-bold text-white text-sm">New Payment Received!</h3>
                <p class="text-xs text-slate-400 mt-1">A user has uploaded payment proof. Please review.</p>
            </div>
            <button onclick="this.parentElement.classList.add('hidden')" class="text-slate-500 hover:text-white"><i data-lucide="x" class="w-4 h-4"></i></button>
        </div>
    </div>

    <!-- ================= 3. USER TOOL VIEW ================= -->
    <div id="tool-view" class="absolute inset-0 z-30 bg-[#0B1120] hidden flex flex-col">
        
        <!-- Navbar -->
        <div class="border-b border-slate-800 bg-[#0F172A] px-6 py-3 flex items-center justify-between shadow-sm z-30">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-xl shadow-lg shadow-indigo-500/20">
                    <i data-lucide="mic-2" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-white leading-tight">Creator Studio</h1>
                    <p class="text-[10px] text-slate-400 font-medium">Logged in as: <span id="user-display-name" class="text-indigo-400">Guest</span></p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button id="admin-back-btn" onclick="backToAdmin()" class="hidden px-3 py-1.5 bg-slate-800 hover:bg-slate-700 text-white text-xs font-bold rounded-lg border border-slate-600 transition-all">
                    <i data-lucide="layout-dashboard" class="w-3 h-3 inline mr-1"></i> Admin Panel
                </button>
                
                <button id="upgrade-btn-nav" class="hidden flex items-center gap-2 px-4 py-1.5 bg-gradient-to-r from-amber-500 to-orange-600 text-white text-xs font-bold rounded-full shadow-lg hover:shadow-orange-500/20 transition-all transform hover:scale-105 upgrade-trigger">
                    <i data-lucide="crown" class="w-3 h-3"></i> Upgrade Pro
                </button>

                <span id="user-plan-badge" class="text-[10px] bg-slate-800 text-slate-400 px-3 py-1 rounded-full border border-slate-700 uppercase font-bold tracking-wide">Free</span>
                
                <div class="h-6 w-px bg-slate-800 mx-1"></div>

                <button onclick="toggleSettings(true)" class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-all" title="API Settings">
                    <i data-lucide="key" class="w-5 h-5"></i>
                </button>
                <button onclick="logout()" class="p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-all" title="Logout">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        <!-- Main Workspace -->
        <div class="flex-1 p-4 md:p-8 max-w-7xl mx-auto w-full grid lg:grid-cols-12 gap-6 overflow-y-auto">
            
            <!-- Left Column: Input (Span 7) -->
            <div class="lg:col-span-7 flex flex-col gap-4">
                <div class="bg-[#1E293B] border border-slate-700 rounded-3xl p-1 flex-1 flex flex-col shadow-xl min-h-[400px] relative transition-all focus-within:border-indigo-500/50 focus-within:ring-1 focus-within:ring-indigo-500/20">
                    <!-- Toolbar -->
                    <div class="px-6 py-3 border-b border-slate-700/50 flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Script Editor</span>
                        <div class="flex gap-2">
                            <span id="pro-status" class="hidden text-[10px] bg-amber-500/10 text-amber-400 border border-amber-500/20 px-2 py-0.5 rounded-md font-bold flex items-center gap-1">
                                <i data-lucide="zap" class="w-3 h-3"></i> UNLIMITED
                            </span>
                        </div>
                    </div>
                    
                    <textarea id="text-input" class="flex-1 w-full bg-transparent text-lg p-6 resize-none outline-none text-slate-200 placeholder:text-slate-600 leading-relaxed" placeholder="Enter your text here... The AI handles unlimited length automatically."></textarea>
                    
                    <!-- Free Limit Overlay -->
                    <div id="limit-overlay" class="hidden absolute bottom-14 left-4 right-4 bg-red-500/10 border border-red-500/30 text-red-300 p-4 rounded-xl backdrop-blur-md text-sm flex justify-between items-center animate-in fade-in slide-in-from-bottom-2 z-10">
                        <span class="flex items-center gap-2"><i data-lucide="lock" class="w-4 h-4"></i> Free Plan Limit Reached (200 chars)</span>
                        <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-1.5 rounded-lg text-xs font-bold transition-colors upgrade-trigger">Upgrade Now</button>
                    </div>

                    <div class="px-6 py-3 border-t border-slate-700/50 flex justify-between items-center bg-slate-800/30 rounded-b-3xl">
                        <span class="text-xs text-slate-500 font-mono flex items-center gap-2">
                            <i data-lucide="type" class="w-3 h-3"></i> 
                            <span id="char-count">0</span> / <span id="max-chars">200</span> chars
                        </span>
                        <button onclick="document.getElementById('text-input').value=''; handleInput({target:{value:''}})" class="text-[10px] text-slate-500 hover:text-white uppercase font-bold tracking-wider">Clear</button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Controls (Span 5) -->
            <div class="lg:col-span-5 flex flex-col gap-6">
                
                <!-- Voice Selector -->
                <div class="bg-[#1E293B] border border-slate-700 rounded-3xl flex flex-col overflow-hidden relative shadow-xl h-[400px]">
                    <!-- Upgrade Banner -->
                    <div id="panel-upgrade-btn" class="hidden absolute top-[52px] left-0 right-0 bg-gradient-to-r from-amber-500/20 to-orange-500/20 border-y border-amber-500/20 p-2 flex justify-between items-center px-6 z-20 backdrop-blur-sm">
                        <span class="text-[10px] text-amber-200 font-bold flex items-center gap-1"><i data-lucide="lock" class="w-3 h-3"></i> Premium Voices Locked</span>
                        <button class="text-[10px] bg-amber-500 hover:bg-amber-400 text-black px-3 py-1 rounded-full font-bold upgrade-trigger transition-colors shadow-lg shadow-amber-500/20">Unlock Now</button>
                    </div>

                    <div class="px-6 py-4 border-b border-slate-700 bg-[#1E293B] sticky top-0 z-10 flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">AI Voice Model</span>
                        <i data-lucide="sliders-horizontal" class="w-4 h-4 text-slate-500"></i>
                    </div>

                    <!-- Speed Control -->
                    <div class="p-5 bg-[#162032] border-b border-slate-700">
                        <div class="flex justify-between mb-2 text-xs font-medium text-slate-400">
                            <span>Speaking Rate</span>
                            <span id="speed-val" class="text-emerald-400 font-bold">1.0x</span>
                        </div>
                        <input type="range" id="speed-range" min="0.5" max="2.0" step="0.1" value="1.0" class="w-full accent-emerald-500">
                    </div>

                    <!-- List -->
                    <div class="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar bg-[#0f172a]" id="voice-list">
                        <!-- JS Injects Voices Here -->
                    </div>
                </div>

                <!-- Action Box -->
                <div class="bg-[#1E293B] border border-slate-700 rounded-3xl p-6 shadow-xl relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-40 h-40 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none"></div>
                    
                    <div class="relative z-10 space-y-4">
                        <!-- Progress Bar -->
                        <div id="progress-container" class="hidden space-y-2 mb-2">
                            <div class="flex justify-between text-[10px] font-bold text-emerald-400 uppercase tracking-wider">
                                <span>Generating Audio...</span>
                                <span id="progress-pct">0%</span>
                            </div>
                            <div class="h-2 bg-slate-800 rounded-full overflow-hidden border border-slate-700">
                                <div id="progress-bar" class="h-full bg-emerald-500 transition-all duration-300 w-0 shadow-[0_0_10px_rgba(16,185,129,0.5)]"></div>
                            </div>
                        </div>

                        <!-- Main Button -->
                        <button id="generate-btn" onclick="generateAudio()" class="w-full py-4 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white font-bold rounded-2xl shadow-lg shadow-emerald-900/30 transition-all flex items-center justify-center gap-2 active:scale-95 group border border-emerald-500/20">
                            <i data-lucide="wand-2" class="w-5 h-5 group-hover:rotate-12 transition-transform"></i> 
                            <span>Generate Audio</span>
                        </button>

                        <!-- Result / Download -->
                        <div id="result-container" class="hidden space-y-4 pt-2 animate-in fade-in slide-in-from-bottom-2">
                            <div class="bg-slate-900/80 p-3 rounded-xl border border-slate-700 shadow-inner">
                                <audio id="audio-player" controls class="w-full h-10"></audio>
                            </div>
                            
                            <div class="relative group">
                                <a id="download-link" href="#" download class="flex items-center justify-center gap-2 w-full py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-medium transition-colors border border-slate-600">
                                    <i data-lucide="download" class="w-4 h-4"></i> Download File
                                </a>
                                
                                <!-- Lock Overlay -->
                                <div id="download-lock" class="absolute inset-0 bg-slate-900/90 backdrop-blur-[2px] flex items-center justify-center rounded-xl cursor-pointer upgrade-trigger z-20 border border-amber-500/30 transition-opacity hover:bg-slate-900/95">
                                    <span class="text-xs font-bold text-amber-400 flex items-center gap-2 shadow-black drop-shadow-md uppercase tracking-wide">
                                        <i data-lucide="lock" class="w-4 h-4"></i> Upgrade to Download
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- ================= 4. UPGRADE MODAL ================= -->
    <div id="upgrade-modal" class="fixed inset-0 bg-black/80 backdrop-blur-md z-50 flex items-center justify-center hidden p-4">
        <div class="bg-[#1E293B] border border-slate-700 rounded-3xl w-full max-w-md p-8 shadow-2xl relative animate-in zoom-in-95 overflow-hidden">
            <!-- Bg Decor -->
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-amber-400 to-orange-500"></div>
            
            <button onclick="toggleUpgrade(false)" class="absolute top-4 right-4 text-slate-400 hover:text-white p-1 rounded-full hover:bg-slate-800 transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            
            <div class="text-center mb-8">
                <div class="inline-flex p-4 rounded-full bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-amber-400 mb-4 border border-amber-500/20 shadow-lg shadow-amber-900/20">
                    <i data-lucide="crown" class="w-8 h-8"></i>
                </div>
                <h2 class="text-2xl font-bold text-white">Upgrade to Pro</h2>
                <div class="flex items-center justify-center gap-2 mt-2">
                    <span class="text-slate-400 line-through text-sm">$5.00</span>
                    <span class="text-emerald-400 font-bold text-lg">$1.00 <span class="text-xs font-normal text-slate-400">/ Month</span></span>
                </div>
                <p class="text-slate-500 text-xs mt-1">(Approx 300 PKR)</p>
            </div>

            <div class="space-y-5">
                <!-- Payment Options -->
                <div class="space-y-3">
                    <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 flex items-center justify-between group hover:border-slate-600 transition-colors">
                        <div>
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Option 1: JazzCash</p>
                            <p class="text-white font-mono text-lg tracking-wide">03222547740</p>
                            <p class="text-xs text-emerald-500 font-medium">Naveed Akhtar</p>
                        </div>
                        <button onclick="navigator.clipboard.writeText('03222547740'); alert('Number Copied!')" class="p-2.5 bg-slate-700 rounded-lg hover:bg-slate-600 text-slate-300 transition-colors active:scale-95">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                        </button>
                    </div>

                    <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 flex items-center justify-between group hover:border-slate-600 transition-colors">
                        <div>
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Option 2: Binance Pay</p>
                            <p class="text-white font-mono text-sm">YOUR_BINANCE_ID</p> 
                            <p class="text-xs text-amber-500 font-medium">USDT / BUSD</p>
                        </div>
                        <button onclick="navigator.clipboard.writeText('YOUR_BINANCE_ID'); alert('ID Copied!')" class="p-2.5 bg-slate-700 rounded-lg hover:bg-slate-600 text-slate-300 transition-colors active:scale-95">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <!-- Upload Section -->
                <div class="pt-2">
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-2 ml-1">Upload Payment Screenshot</label>
                    <div class="relative">
                        <input type="file" id="proof-file" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="document.getElementById('file-name').innerText = this.files[0].name"/>
                        <div class="w-full bg-slate-800 border border-slate-700 border-dashed rounded-xl p-4 text-center flex items-center justify-center gap-3 text-slate-400 hover:bg-slate-750 transition-colors">
                            <i data-lucide="upload-cloud" class="w-5 h-5"></i>
                            <span id="file-name" class="text-sm truncate">Click to select image...</span>
                        </div>
                    </div>
                </div>

                <button onclick="submitUpgradeRequest()" class="w-full py-4 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-bold rounded-xl shadow-lg shadow-orange-900/20 active:scale-95 transition-all flex items-center justify-center gap-2">
                    Submit Request <i data-lucide="send" class="w-4 h-4"></i>
                </button>
                
                <div id="upgrade-status" class="hidden bg-emerald-500/10 border border-emerald-500/20 p-3 rounded-xl text-center">
                    <p class="text-xs text-emerald-400 font-bold flex items-center justify-center gap-2">
                        <i data-lucide="check-circle" class="w-4 h-4"></i> Request Sent! Waiting for Admin.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= 5. SETTINGS MODAL ================= -->
    <div id="settings-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-start justify-center pt-20 hidden">
        <div class="bg-[#1E293B] border border-slate-700 rounded-2xl p-6 w-full max-w-md shadow-2xl animate-in fade-in zoom-in-95">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-white font-bold flex items-center gap-2"><i data-lucide="key" class="w-4 h-4 text-indigo-400"></i> API Key Manager</h3>
                <button onclick="toggleSettings(false)" class="text-slate-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <div class="space-y-4">
                <div class="bg-blue-500/10 border border-blue-500/20 p-3 rounded-xl text-xs text-blue-300 flex gap-2">
                    <i data-lucide="info" class="w-4 h-4 flex-shrink-0 mt-0.5"></i>
                    <p>A personal API key ensures the tool works just for you. Get one for free from Google.</p>
                </div>

                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-slate-400 uppercase">Paste Gemini Key</label>
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-indigo-400 hover:text-indigo-300 flex items-center gap-1 hover:underline font-bold">
                            Get Free Key <i data-lucide="external-link" class="w-3 h-3"></i>
                        </a>
                    </div>
                    <div class="flex gap-2">
                        <input id="api-key-input" type="password" placeholder="AIza..." class="flex-1 bg-[#0B1120] border border-slate-700 rounded-xl px-4 py-3 text-sm outline-none focus:border-indigo-500 text-white transition-colors">
                        <button onclick="saveApiKey()" class="px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold transition-all shadow-lg">Save</button>
                    </div>
                </div>
                
                <div class="border-t border-slate-700 pt-4 flex justify-between items-center">
                    <span id="active-keys-count" class="text-xs font-mono text-emerald-400 bg-emerald-900/20 px-2 py-1 rounded border border-emerald-900/50">0 Keys Active</span>
                    <button onclick="if(confirm('Clear all keys?')) { localStorage.removeItem(`keys_${state.user.username}`); state.keys=[]; document.getElementById('active-keys-count').innerText='0 Keys'; }" class="text-xs text-red-400 hover:text-red-300 hover:underline">Clear All</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ERROR TOAST -->
    <div id="error-toast" class="fixed bottom-6 right-6 max-w-sm bg-[#1E293B] border-l-4 border-red-500 shadow-2xl rounded-lg p-4 hidden z-50 animate-in slide-in-from-right">
        <div class="flex items-start gap-3">
            <i data-lucide="alert-circle" class="w-5 h-5 text-red-500 mt-0.5"></i>
            <div>
                <h3 class="font-bold text-red-400 text-sm">Error</h3>
                <p id="error-msg" class="text-xs text-slate-300 mt-1">Something went wrong.</p>
            </div>
            <button id="close-toast" class="ml-auto text-slate-400 hover:text-white transition-colors"><i data-lucide="x" class="w-4 h-4"></i></button>
        </div>
    </div>

    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script>
        // --- CONFIGURATION ---
        // ðŸ”´ Replace this with your ACTUAL Project URL from Step 2
        const SUPABASE_URL = "https://sbivtpblakhopcrxmkfn.supabase.co"; 
        const SUPABASE_KEY = "sb_publishable__scEYcv0MWW-W51dmvCxDw_QZtWkbmZ"; // Public key
        
        const ADMIN_USER = "growwithhaider"; // Must match DB
        const TTS_MODEL = "gemini-2.5-flash-preview-tts";
        const CHUNK_SIZE = 4000;

        const VOICES = [
            { id: "Fenrir", gender: "Male", desc: "Deep", premium: false }, 
            { id: "Kore", gender: "Female", desc: "Soft", premium: false },
            { id: "Puck", gender: "Male", desc: "Energetic", premium: true }, 
            { id: "Charon", gender: "Male", desc: "Deep", premium: true },
            { id: "Aoede", gender: "Female", desc: "Warm", premium: true }, 
            { id: "Zephyr", gender: "Male", desc: "Smooth", premium: true },
            { id: "Leda", gender: "Female", desc: "Gentle", premium: true }, 
            { id: "Orus", gender: "Male", desc: "Confident", premium: true },
            { id: "Umbriel", gender: "Male", desc: "Steady", premium: true }, 
            { id: "Iapetus", gender: "Male", desc: "Serious", premium: true }
        ];

        let state = { user: null, voice: "Fenrir", keys: [], keyIdx: 0, speed: 1.0 };
        const el = (id) => document.getElementById(id);
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function init() {
            lucide.createIcons();
            const s = sessionStorage.getItem('session');
            if(s) loginSuccess(JSON.parse(s));
            
            el('text-input').oninput = handleInput;
            el('speed-range').oninput = (e) => { state.speed = parseFloat(e.target.value); el('speed-val').innerText = state.speed + 'x'; };
            document.querySelectorAll('.upgrade-trigger').forEach(b => b.onclick = () => toggleUpgrade(true));
            renderVoices();
        }

        // --- AUTHENTICATION ---
        window.toggleAuthMode = (m) => {
            el('login-form-container').classList.toggle('hidden', m!=='login');
            el('signup-form-container').classList.toggle('hidden', m!=='signup');
        }

        window.handleLogin = async (e) => {
            e.preventDefault();
            const u = el('login-user').value.toLowerCase().trim();
            const p = el('login-pass').value.trim();

            try {
                const { data, error } = await supabase.from('users').select('*').eq('username', u).eq('password', p).single();
                if(error || !data) throw new Error("Invalid credentials");
                
                // Check Expiry
                if(data.plan === 'pro' && data.plan_expires && Date.now() > data.plan_expires) {
                    await supabase.from('users').update({ plan: 'free', plan_expires: null }).eq('id', data.id);
                    data.plan = 'free';
                    alert("Your Pro Plan has expired.");
                }
                loginSuccess(data);
            } catch(err) {
                el('auth-error').innerText = err.message;
                el('auth-error').classList.remove('hidden');
            }
        }

        window.handleSignup = async (e) => {
            e.preventDefault();
            const u = el('signup-user').value.toLowerCase().replace(/\s/g,'');
            const p = el('signup-pass').value;
            const em = el('signup-email').value;

            try {
                const { data: exists } = await supabase.from('users').select('username').eq('username', u).single();
                if(exists) throw new Error("Username taken");

                const { error } = await supabase.from('users').insert([{ username: u, password: p, email: em }]);
                if(error) throw error;
                
                alert("Account created! Login now.");
                toggleAuthMode('login');
            } catch(err) {
                el('auth-error').innerText = err.message;
                el('auth-error').classList.remove('hidden');
            }
        }

        function loginSuccess(user) {
            state.user = user;
            sessionStorage.setItem('session', JSON.stringify(user));
            el('auth-view').classList.add('hidden');
            
            if(user.role === 'admin') {
                el('admin-view').classList.remove('hidden');
                initAdminRealtime();
            } else {
                el('tool-view').classList.remove('hidden');
                setupUserUI();
            }
        }

        window.logout = () => {
            sessionStorage.removeItem('session');
            location.reload();
        }

        // --- ADMIN REALTIME ---
        function initAdminRealtime() {
            loadAdminData();
            supabase.channel('custom-all-channel')
            .on('postgres_changes', { event: '*', schema: 'public', table: 'requests' }, (payload) => {
                if(payload.eventType === 'INSERT') showAdminNotification();
                loadAdminData();
            })
            .subscribe();
        }

        async function loadAdminData() {
            const { data: users } = await supabase.from('users').select('*');
            const { data: reqs } = await supabase.from('requests').select('*').order('created_at', { ascending: false });
            
            el('admin-total-users').innerText = users.length;
            const pending = reqs.filter(r => r.status === 'pending');
            el('admin-pending-count').innerText = pending.length;
            el('admin-notification-dot').style.display = pending.length > 0 ? 'block' : 'none';
            
            let rev = 0; users.forEach(u => { if(u.plan === 'pro') rev += 1; });
            el('admin-revenue').innerText = rev.toFixed(2);

            el('requests-list').innerHTML = pending.map(r => `
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 mb-3 animate-in slide-in-from-left-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-white text-sm">${r.username}</span>
                        <span class="text-[10px] text-slate-400">${new Date(r.created_at).toLocaleDateString()}</span>
                    </div>
                    <div class="h-32 bg-black rounded-lg overflow-hidden border border-slate-600 mb-3 relative group cursor-pointer" onclick="window.open('${r.image}')">
                        <img src="${r.image}" class="w-full h-full object-contain">
                        <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><span class="text-xs font-bold">View</span></div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="handleReq(${r.id}, 'approve', '${r.username}')" class="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white text-xs py-2 rounded-lg font-bold transition-colors">Approve</button>
                        <button onclick="handleReq(${r.id}, 'reject')" class="flex-1 bg-red-600 hover:bg-red-500 text-white text-xs py-2 rounded-lg font-bold transition-colors">Reject</button>
                    </div>
                </div>
            `).join('') || '<p class="text-slate-500 text-center text-sm py-4">No pending requests</p>';

            el('user-table-body').innerHTML = users.map(u => `
                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                    <td class="p-3 text-sm font-bold text-white">${u.username}</td>
                    <td class="p-3"><span class="px-2 py-1 rounded text-[10px] font-bold uppercase ${u.plan==='pro'?'bg-emerald-900 text-emerald-400 border border-emerald-700':'bg-slate-700 text-slate-300 border border-slate-600'}">${u.plan}</span></td>
                    <td class="p-3 text-xs font-mono text-slate-400">${u.plan_expires ? new Date(u.plan_expires).toLocaleDateString() : '-'}</td>
                    <td class="p-3 text-right"><button onclick="deleteUser(${u.id})" class="text-red-400 hover:text-red-300 p-1"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                </tr>
            `).join('');
            lucide.createIcons();
        }

        window.handleReq = async (id, action, username) => {
            if(action === 'approve') {
                // 30 Days Expiry
                const expiry = Date.now() + (30 * 24 * 60 * 60 * 1000);
                await supabase.from('users').update({ plan: 'pro', plan_expires: expiry }).eq('username', username);
            }
            await supabase.from('requests').update({ status: action }).eq('id', id);
        }
        
        window.deleteUser = async (id) => { 
            if(confirm("Delete user?")) { 
                await supabase.from('users').delete().eq('id', id); 
            } 
        }

        // --- USER ACTIONS ---
        window.submitUpgradeRequest = () => {
            const file = el('proof-file').files[0];
            if(!file) return alert("Upload proof");
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    await supabase.from('requests').insert([{ 
                        username: state.user.username, 
                        image: e.target.result 
                    }]);
                    el('upgrade-status').classList.remove('hidden');
                    setTimeout(() => {
                        el('upgrade-status').classList.add('hidden');
                        toggleUpgrade(false);
                    }, 2000);
                } catch(err) { alert("Upload failed"); }
            };
            reader.readAsDataURL(file);
        }

        // --- UI HELPERS ---
        function setupUserUI() { 
            el('user-display-name').innerText = state.user.username;
            const isPro = state.user.plan === 'pro' || state.user.role === 'admin';
            el('user-plan-badge').innerText = isPro ? 'PRO' : 'FREE';
            
            // UI Locks
            el('max-chars').innerText = isPro ? 'âˆž' : '200';
            if(isPro) { 
                el('download-lock').classList.add('hidden'); 
                el('upgrade-btn-nav').classList.add('hidden'); 
                el('panel-upgrade-btn').classList.add('hidden');
                if(state.user.role === 'admin') el('admin-back-btn').classList.remove('hidden');
            } else { 
                el('download-lock').classList.remove('hidden'); 
                el('upgrade-btn-nav').classList.remove('hidden'); 
                el('panel-upgrade-btn').classList.remove('hidden'); 
            }
            
            // Load Local Keys
            const keys = localStorage.getItem(`keys_${state.user.username}`);
            if(keys) state.keys = JSON.parse(keys);
            el('active-keys-count').innerText = `${state.keys.length} Keys`;
            renderVoices();
        }

        window.handleInput = (e) => {
            const val = e.target.value;
            state.text = val;
            el('char-count').innerText = val.length;
            
            const isFree = state.user?.plan === 'free' && state.user?.role !== 'admin';
            if(isFree && val.length > 200) {
                el('limit-overlay').classList.remove('hidden');
                el('text-input').classList.add('text-red-300');
            } else {
                el('limit-overlay').classList.add('hidden');
                el('text-input').classList.remove('text-red-300');
            }
        }

        // --- CORE AUDIO LOGIC ---
        function renderVoices() {
            const isFree = state.user?.role !== 'admin' && state.user?.plan === 'free';
            el('voice-list').innerHTML = VOICES.map(v => {
                const locked = isFree && v.premium;
                return `
                <div onclick="${locked ? "toggleUpgrade(true)" : `selectVoice('${v.id}')`}" class="p-3 rounded-xl cursor-pointer flex items-center justify-between group transition-all ${state.voice===v.id ? 'bg-emerald-600/20 border border-emerald-500/50' : 'hover:bg-slate-800 border border-transparent'} ${locked ? 'opacity-60' : ''}">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${state.voice===v.id ? 'bg-emerald-500 text-white' : 'bg-slate-700 text-slate-400'}">
                            ${locked ? '<i data-lucide="lock" class="w-3 h-3"></i>' : v.id[0]}
                        </div>
                        <div>
                            <h4 class="text-sm font-bold text-white flex items-center gap-2">
                                ${v.id} ${v.premium ? '<span class="text-[8px] bg-amber-500/20 text-amber-400 px-1 rounded border border-amber-500/30">PRO</span>' : ''}
                            </h4>
                            <p class="text-[10px] text-slate-500">${v.gender} â€¢ ${v.desc}</p>
                        </div>
                    </div>
                    <button class="p-2 rounded-full hover:bg-slate-700 text-slate-400 transition-colors"><i data-lucide="play" class="w-3 h-3 fill-current"></i></button>
                </div>`;
            }).join('');
            lucide.createIcons();
        }
        window.selectVoice = (id) => { state.voice = id; renderVoices(); };

        window.generateAudio = async () => {
            if(!state.text.trim()) return alert("Please enter text");
            const isFree = state.user.role!=='admin' && state.user.plan==='free';
            if(isFree && state.text.length>200) return toggleUpgrade(true);
            if(state.keys.length===0) return toggleSettings(true);

            setIsGenerating(true);
            try {
                const chunks = chunkText(state.text);
                let completed = 0;
                const promises = chunks.map(async (chunk, idx) => {
                    const buf = await fetchAudio(chunk);
                    completed++;
                    el('progress-bar').style.width = `${(completed/chunks.length)*100}%`;
                    return { idx, buf };
                });
                
                const results = await Promise.all(promises);
                results.sort((a,b) => a.idx - b.idx);
                const blob = new Blob(results.map(r => r.buf), { type: 'audio/mp3' });
                const url = URL.createObjectURL(blob);
                
                el('audio-player').src = url;
                el('download-link').href = url;
                el('download-link').download = `voice-${state.voice}-${Date.now()}.mp3`;
                el('result-container').classList.remove('hidden');
            } catch(e) { 
                alert("Error: " + e.message); 
            } finally { setIsGenerating(false); }
        }

        async function fetchAudio(text) {
            let attempts = 0;
            while(attempts < state.keys.length) {
                const key = state.keys[state.keyIdx];
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${TTS_MODEL}:generateContent?key=${key}`, {
                        method:'POST', headers: {'Content-Type':'application/json'},
                        body: JSON.stringify({ contents: [{parts:[{text}]}], generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: state.voice } } } } })
                    });
                    if(!res.ok) throw new Error(await res.text());
                    const data = await res.json();
                    const bin = atob(data.candidates[0].content.parts[0].inlineData.data);
                    const bytes = new Uint8Array(bin.length);
                    for(let i=0; i<bin.length; i++) bytes[i] = bin.charCodeAt(i);
                    return bytes.buffer;
                } catch(e) {
                    state.keyIdx = (state.keyIdx + 1) % state.keys.length;
                    attempts++;
                }
            }
            throw new Error("All Keys Exhausted!");
        }

        function chunkText(str) { const c=[]; let cur=""; str.match(/[^.!?]+[.!?]+|[^.!?]+$/g).forEach(s=>{ if(cur.length+s.length<CHUNK_SIZE) cur+=s; else { if(cur) c.push(cur); cur=s; } }); if(cur) c.push(cur); return c; }
        
        // Helpers
        window.toggleSettings = (s) => el('settings-modal').classList.toggle('hidden', !s);
        window.toggleUpgrade = (s) => el('upgrade-modal').classList.toggle('hidden', !s);
        window.logout = () => { sessionStorage.removeItem('session'); location.reload(); }
        window.saveApiKey = () => { const k=el('api-key-input').value.trim(); if(k) { let keys=JSON.parse(localStorage.getItem(`keys_${state.user.username}`)||'[]'); keys.push(k); localStorage.setItem(`keys_${state.user.username}`, JSON.stringify(keys)); state.keys=keys; el('api-key-input').value=""; el('active-keys-count').innerText=`${state.keys.length} Keys`; alert("Saved"); } }
        window.goToToolAsAdmin = () => { el('admin-view').classList.add('hidden'); el('tool-view').classList.remove('hidden'); setupUserUI(); }
        window.backToAdmin = () => { el('tool-view').classList.add('hidden'); el('admin-view').classList.remove('hidden'); }
        
        function setIsGenerating(v) {
            if(v) { 
                el('generate-btn').disabled=true; 
                el('generate-btn').innerHTML=`<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Processing...`; 
                el('progress-container').classList.remove('hidden'); 
                el('result-container').classList.add('hidden'); 
            } else { 
                el('generate-btn').disabled=false; 
                el('generate-btn').innerHTML=`<i data-lucide="wand-2" class="w-5 h-5"></i> Generate Audio`; 
            }
            lucide.createIcons();
        }
        
        function showAdminNotification() { 
            el('admin-toast').classList.remove('hidden'); 
            setTimeout(()=>el('admin-toast').classList.add('hidden'), 5000); 
            const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
            audio.play().catch(()=>{});
        }

        init();
    </script>
</body>
</html>
